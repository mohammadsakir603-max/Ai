<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">

<!-- ✅ GOOGLE ADSENSE META -->
<meta name="google-adsense-account" content="ca-pub-5244808241769330">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>Vixora AI</title>

<style>
*{box-sizing:border-box;font-family:Poppins,system-ui,sans-serif}
body{
  margin:0;
  background:#0b0f14;
  color:#fff;
  display:flex;
  justify-content:center;
}
.app{
  width:100%;
  max-width:380px;
  height:100dvh;
  display:flex;
  flex-direction:column;
}
.header{
  padding:14px;
  text-align:center;
  font-weight:600;
  border-bottom:1px solid #222;
}
.chat{
  flex:1;
  padding:12px;
  overflow-y:auto;
}
.msg{
  margin-bottom:10px;
  padding:12px;
  border-radius:14px;
  max-width:90%;
  font-size:14px;
  line-height:1.4;
  word-wrap:break-word;
}
.user{background:#2563eb;margin-left:auto}
.ai{background:#1f2933}

/* CODE */
.code-box{
  background:#000;
  border-radius:10px;
  padding:12px;
  position:relative;
}
.code-box code{
  color:#22c55e;
  font-size:13px;
  white-space:pre;
}
.copy-btn{
  position:absolute;
  top:6px;
  right:8px;
  font-size:12px;
  color:#22c55e;
  border:1px solid #22c55e;
  padding:2px 6px;
  border-radius:6px;
  cursor:pointer;
}

/* TYPING */
.typing{
  background:#1f2933;
  padding:10px 14px;
  border-radius:14px;
  display:inline-block;
  margin-bottom:10px;
}
.dots span{
  animation:blink 1.4s infinite both;
  font-size:20px;
}
.dots span:nth-child(2){animation-delay:.2s}
.dots span:nth-child(3){animation-delay:.4s}
@keyframes blink{
  0%{opacity:.2}
  20%{opacity:1}
  100%{opacity:.2}
}

/* INPUT */
.input-area{
  display:flex;
  gap:8px;
  padding:10px;
  border-top:1px solid #222;
}
input{
  flex:1;
  padding:12px;
  background:#0b0f14;
  border:1px solid #333;
  color:#fff;
  border-radius:10px;
}
button{
  width:48px;
  border:1px solid #2563eb;
  background:transparent;
  color:#2563eb;
  border-radius:10px;
  font-size:18px;
  cursor:pointer;
}
button.loading{
  border-color:#22c55e;
  color:#22c55e;
}
</style>
</head>

<body>

<div class="app">
  <div class="header">Vixora AI</div>

  <div class="chat" id="chat">
    <div class="msg ai">How can I help you?</div>
  </div>

  <div class="input-area">
    <input id="input" placeholder="Ask with Vixora">
    <button id="sendBtn" onclick="send()">➤</button>
  </div>
</div>

<script>
const chat=document.getElementById("chat");
const input=document.getElementById("input");
const btn=document.getElementById("sendBtn");

let typingDiv=null;
let controller=null;

/* MESSAGE */
function addMessage(text,type){
  const msg=document.createElement("div");
  msg.className="msg "+type;

  if(text.includes("```")){
    const code=text.replace(/```[a-z]*|```/gi,"").trim();
    msg.innerHTML=`
      <div class="code-box">
        <div class="copy-btn" onclick="navigator.clipboard.writeText(\`${code}\`)">Copy</div>
        <code>${code.replace(/</g,"&lt;").replace(/>/g,"&gt;")}</code>
      </div>`;
  }else{
    msg.textContent=text;
  }
  chat.appendChild(msg);
  chat.scrollTop=chat.scrollHeight;
}

/* TYPING */
function showTyping(){
  hideTyping();
  typingDiv=document.createElement("div");
  typingDiv.className="typing ai";
  typingDiv.innerHTML=`<div class="dots"><span>●</span><span>●</span><span>●</span></div>`;
  chat.appendChild(typingDiv);
}
function hideTyping(){
  if(typingDiv){typingDiv.remove();typingDiv=null}
}

/* SEND */
async function send(){
  const text=input.value.trim();
  if(!text) return;

  if(controller) controller.abort();

  controller=new AbortController();

  addMessage(text,"user");
  input.value="";
  showTyping();

  btn.textContent="⏳";
  btn.classList.add("loading");

  try{
    const res=await fetch("/api/chat",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({message:text}),
      signal:controller.signal
    });
    const data=await res.json();
    hideTyping();
    addMessage(data.reply,"ai");
  }catch(e){
    hideTyping();
  }

  btn.textContent="➤";
  btn.classList.remove("loading");
  controller=null;
}

/* CANCEL ON BUTTON */
btn.addEventListener("click",()=>{
  if(controller){
    controller.abort();
    btn.textContent="➤";
    btn.classList.remove("loading");
    hideTyping();
    controller=null;
  }
});

input.addEventListener("keydown",e=>{
  if(e.key==="Enter") send();
});
</script>

</body>
</html>
